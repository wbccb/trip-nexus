# TripNexus
An AI-planned travel product

## 核心需求

1. 输入旅游关键信息（目的地、天数、预算、偏好），AI 自动生成结构化行程（每日景点、交通、时间安排）。
2. 行程数据实时同步到地图，可视化标记景点、路线及停留时间。
3. 支持手动修改行程（增减景点、调整顺序、修改时间），地图同步更新。
4. RAG 接入旅游公开数据（景点介绍、开放时间、交通方式），提升行程准确性。


## 概要设计

### 技术选型
- 前端交互：Streamlit
- 地图可视化：Folium（+Leaflet）
- LLM核心：Llama 3（8B）/Qwen（7B） => 本地运行调试
- RAG框架：LangChain + Chroma	
- 数据来源：公开旅游API + 爬取数据
- 数据存储：Chroma（向量）+ JSON文件文件（行程）

> MVP阶段，无需复杂数据库，尽可能轻量和免费

### 架构分层
- 前端交互层：`Streamlit`实现输入表单、行程展示、地图嵌入
- 核心服务层：`LangChain`整合RAG（数据检索）+ LLM（根据RAG数据调用大模型进行行程生成）+行程逻辑处理
- 地图处理层：`Folium`接收结构化行程数据，生成可视化地图
- 数据层：`Chroma`存储旅游知识库向量，JSON文件存储用户行程实例

## 详细设计

### 前端交互模块（Streamlit）
- 页面结构：3 个核心页面（输入页、行程展示页、地图页），支持页面切换
- 输入组件：目的地输入框、天数选择器、预算滑块、偏好复选框（自然景观 / 人文等）
- 交互控件：行程修改按钮（增 / 删 / 改）、地图缩放 / 定位控件、重置 / 重新生成按钮
- 展示组件：行程列表（按天分组）、景点详情弹窗、地图嵌入容器

### RAG 知识模块
- 数据采集：爬取马蜂窝 / 携程公开景点数据（景点名、地址、开放时间、交通），整理为 JSON 格式
- 向量库构建：LangChain 文档加载器解析数据，文本分割后嵌入（用 Sentence-BERT），存入 Chroma
- 检索逻辑：用户输入 + 行程上下文作为检索词，召回相关景点 / 交通数据，传给 LLM 辅助生成行程

### LLM 行程生成模块
- 行程优化：LLM 结合 RAG 检索结果，避免 “景点关闭”“路线绕路” 等问题
- 提示词设计：明确结构化输出格式（天数 - 时段 - 景点 - 地址 - 停留时间 - 交通方式），方便地图解析
- 修改联动：用户修改行程后，LLM 接收修改指令，重新调整相关时段 / 路线，保持逻辑连贯


### 地图可视化模块（Folium）
- 数据解析：接收 LLM 输出的结构化行程，提取景点经纬度、时间顺序、交通路线
- 地图生成：标记景点（不同颜色区分时段）、绘制每日路线（折线图）、添加景点详情弹窗
- 同步更新：监听前端修改操作（如删除景点），实时重新渲染地图元素

### 行程逻辑处理模块
- 结构化数据定义：统一行程数据格式（JSON Schema），确保 LLM 输出、地图解析、前端展示一致
- 修改逻辑：支持 3 类操作（增：添加景点并重新分配时间；删：删除景点后调整后续行程；改：修改时间 / 顺序后同步路线）

## 开发计划

- 阶段1: 环境搭建 + 基础依赖
- 阶段2: RAG知识库构建
- 阶段3: LLM行程生成
- 阶段4: 地图可视化 + 行程绑定
- 阶段5: 前端整合
- 阶段6: 文档编写 + Github上线

## 环境初始化

```shell
pyenv local 3.12.0
# 创建虚拟环境
python -m venv venv
# 激活环境
source venv/bin/activate
# 安装核心依赖
pip install -r requirements.txt
```

> 如果使用`PyCharm`，需要设置`Python Interpreter` -> `/xxxx/TripNexus/venv/bin/python`


## 思路借鉴
1. `https://chat.qwen.ai/c/4c7b4d88-daa9-43e6-a446-5c689db33aeb` 的旅游规划师agent模块